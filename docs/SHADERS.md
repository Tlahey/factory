# System Shaders Documentation

The project uses custom GLSL shaders (ShaderMaterial) for the main visual elements: Grass, Sand, and Water.
These shaders are designed to follow a "Ghibli / Toon" aesthetic, relying on procedural noise rather than textures to ensure infinite resolution without repetition.

## üìÅ Architecture

The shaders are located in `src/game/visuals/`:

- `GrassShader.ts`: Grass with wind, noise grain, and earth patches.
- `SandShader.ts`: Sand with dunes, relief, and procedural transition to grass.
- `ToonWaterShader.ts`: Stylized water with Voronoi patterns, shoreline foam, and depth effects.
- `ShaderUtils.ts`: Shared GLSL code (Noise, Clouds).

## ‚òÅÔ∏è Cloud System

To unify the visual experience, a global "Cloud Shadow" system is applied across all terrain shaders.

**How it works:**

1.  **Shared Logic (`ShaderUtils.ts`)**: Contains the `SimplexNoise` implementation and the `getCloudFactor()` function.
2.  **Global Time**: All shaders receive a synchronized `uTime` from `GameApp.ts`.
3.  **Coordination**: The clouds are generated using world coordinates (`vWorldPosition.xz`), ensuring that a cloud passing over the water continues seamlessly onto the sand and grass.

**Parameters:**

- `uWindSpeed`: Speed of the cloud movement.
- `uWindDirection`: Direction vector (normalized).
- `uColorCloud` (or `uColorDark`): The target color when a pixel is in "shadow".

## üåø Grass Shader

A procedural shader that generates a stylized grassy field.

**Layers:**

1.  **Base Layer**: A solid color (`uColorBase`).
2.  **Grain**: High-frequency noise to simulate grass blades/texture.
3.  **Clouds**: Large low-frequency noise darkening the color to `uColorDark`.
4.  **Light**: Static highlights (`uColorLight`) to add richness.
5.  **Earth**: Patches of dirt (`uColorEarth`) generated by distinct noise thresholds.

## üèñÔ∏è Sand Shader

A procedural shader for the beach and transition zones.

**Features:**

- **Relief**: Calculates a normal map on the fly based on noise to simulate dunes.
- **Sparkles**: View-dependent specular highlights simulating sand grains catching the sun.
- **Transition**: Uses vertex height (`vWorldPosition.y`) to blend smoothly into the Grass shader, with added noise to break the straight line.
- **Unified Clouds**: Receives the same cloud shadows as the grass.

## üåä Toon Water Shader

A decorative, non-physically based water shader.

**Features:**

- **Voronoi Patterns**: Two layers of cellular noise (Dark & Light) moving at different speeds to simulate currents and depth.
- **Shoreline Foam**: Uses the Depth Buffer (`tDepth`) to detect where the water intersects with terrain, drawing a white foam line.
- **Opaque**: The water is solid color, not transparent, fitting the toon style.
- **Unified Clouds**: Shadows are applied on top of the final water color.

## üõ†Ô∏è Modifying Shaders

- **Why TS strings?**: We use TypeScript template strings for GLSL to allow easy injection of shared code (`${SimplexNoiseGLSL}`) and type-safe uniform management.
- **Performance**: Heavy noise calculations are done per-pixel. If performance drops, consider moving some noise to a static texture or the vertex shader.
